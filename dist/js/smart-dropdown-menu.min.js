/**
 * @yami_beta/smart-dropdown-menu
 *
 * Copyright (c) 2016 Takahiro Abe
 *
 * This software is released under the MIT license
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.SmartDropdownMenu=t()}(this,function(){"use strict";var e=(function(){function e(e){this.value=e}function t(t){function n(e,t){return new Promise(function(n,i){var u={key:e,arg:t,resolve:n,reject:i,next:null};s?s=s.next=u:(r=s=u,o(e,t))})}function o(n,r){try{var s=t[n](r),u=s.value;u instanceof e?Promise.resolve(u.value).then(function(e){o("next",e)},function(e){o("throw",e)}):i(s.done?"return":"normal",s.value)}catch(e){i("throw",e)}}function i(e,t){switch(e){case"return":r.resolve({value:t,done:!0});break;case"throw":r.reject(t);break;default:r.resolve({value:t,done:!1})}r=r.next,r?o(r.key,r.arg):s=null}var r,s;this._invoke=n,"function"!=typeof t.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(t.prototype[Symbol.asyncIterator]=function(){return this}),t.prototype.next=function(e){return this._invoke("next",e)},t.prototype.throw=function(e){return this._invoke("throw",e)},t.prototype.return=function(e){return this._invoke("return",e)},{wrap:function(e){return function(){return new t(e.apply(this,arguments))}},await:function(t){return new e(t)}}}(),function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}),t=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),n=function(){function n(t,o){e(this,n),this.el=t,this.index=o,this.el.classList.add("item"+this.index),this.el.addEventListener("mouseover",this.openSubmenu.bind(this)),this.el.addEventListener("mouseout",this.closeSubmenu.bind(this))}return t(n,[{key:"openSubmenu",value:function(){this.el.classList.add("show")}},{key:"closeSubmenu",value:function(){this.el.classList.remove("show")}}]),n}(),o=function(){function o(t){e(this,o),this.el=t,this.items=[];for(var i=document.querySelectorAll(".smart-dropdown-menu > .sdm-list > li"),r=0;r<i.length;r++)this.items.push(new n(i[r],r));this.el.addEventListener("mouseover",this.showMenu.bind(this)),this.el.addEventListener("mouseout",this.hideMenu.bind(this)),this.showMenu(),this.appendTriareaStyle(),this.hideMenu()}return t(o,[{key:"showMenu",value:function(e){this.el.classList.add("show")}},{key:"hideMenu",value:function(e){this.el.classList.remove("show")}},{key:"appendTriareaStyle",value:function(){var e=document.getElementById("smart-dropdown-menu-style");e||(e=document.createElement("style"),e.type="text/css",e.id="smart-dropdown-menu-style",document.querySelector("head").appendChild(e));var t=this.calculateTriarea();e.innerHTML=this.objectToStyle(t)}},{key:"calculateTriarea",value:function(){for(var e=this.el.querySelector("li"),t=e.offsetWidth,n=e.offsetHeight,o={},i=0;i<this.items.length;i++){this.items[i].openSubmenu();var r=Math.floor(180*Math.atan2(.5*t,n*i+n/2)/Math.PI);o[".item"+i+":before"]={height:n*i+n/2+"px",transform:"skewX(-"+r+"deg)"};var s=this.items[i].el.querySelector(".sdm-list").offsetHeight,u=s-n/2-n*i,a=Math.floor(180*Math.atan2(.5*t,u)/Math.PI);o[".item"+i+":after"]={"margin-top":"-"+n/2+"px",height:u+"px",transform:"skewX("+a+"deg)"},this.items[i].closeSubmenu()}return o}},{key:"objectToStyle",value:function(e){var t="";return Object.keys(e).forEach(function(n){t+=n+"{",Object.keys(e[n]).forEach(function(o){t+=o+": "+e[n][o]+";"}),t+="}"}),t}}]),o}();return o});
